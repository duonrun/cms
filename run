<?php

declare(strict_types=1);

require __DIR__ . '/vendor/autoload.php';

use Duon\Cli\Runner;
use Duon\Cms\Commands\RecreateDb;
use Duon\I18n\I18n;
use Duon\I18n\Source;
use Duon\Quma\Commands as QumaCommands;
use Duon\Quma\Connection;

$connection = new Connection(
	'pgsql:host=localhost;dbname=duoncms;user=duoncms;password=duoncms',
	[
		'pgsql' => __DIR__ . '/db/sql/pgsql',
		'sqlite' => __DIR__ . '/db/sql/sqlite',
	],
	[
		'install' => [[
			'pgsql' => __DIR__ . '/db/migrations/install/pgsql',
			'sqlite' => __DIR__ . '/db/migrations/install/sqlite',
		]],
		'default' => [[
			'pgsql' => __DIR__ . '/db/migrations/update/pgsql',
			'sqlite' => __DIR__ . '/db/migrations/update/sqlite',
		]],
	],
	fetchMode: PDO::FETCH_ASSOC,
	print: false,
);

// $commands = I18n::commands(
//     dir: __DIR__ . '/locale',
//     domain: 'duon',
//     sources: [
//         new Source(__DIR__ . '/src', '*.php', 'PHP'),
//         new Source(__DIR__ . '/ui', '*.svelte', 'Python'),
//     ],
//     jsonDir: __DIR__ . '/ui/src/locale',
// );
$commands = QumaCommands::get($connection);
$commands->add(new RecreateDb('duoncms', 'duoncms', 'duoncms'));

$runner = new Runner($commands);

exit($runner->run());

// vim: ft=php
